HOWTO Use Python in the web

## The Low-Level View
동적 웹 사이트는 파일 시스템의 파일을 기반으로 하는 것이 아니라 요청이 들어왔을 때 웹 서버가 실행하고 사용자에게 반환되는 콘텐츠를 생성하는 프로그램을 기반으로 한다. 웹 서버들은 게시판 게시 표시, 전자 메일 표시, 소프트웨어 구성 또는 현재 시간 표시 등 모든 종류의 유용한 작업을 수행할 수 있다. 이 프로그램은 서버가 지원하는 모든 프로그래밍 언어로 작성할 수 있다. 대부분의 서버는 파이썬을 지원하기 때문에 파이썬을 사용하여 동적 웹 사이트를 만드는 것이 쉽다.

대부분의 HTTP 서버는 C 또는 C++로 작성되어 있으므로 Python 코드를 직접 실행할 수 없다. 따라서  서버와 프로그램간에 브리지가 필요합니다. 이러한 브리지 또는 인터페이스는 프로그램이 서버와 상호 작용하는 방식을 정의합니다. 최상의 인터페이스를 만들려는 시도가 많이 있었지만 몇 가지만 언급할만한 가치가 있습니다.


모든 웹 서버가 모든 인터페이스를 지원하는 것은 아닙니다. 많은 웹 서버는 오래되고 쓸모없는 인터페이스 만 지원합니다. 그러나 종종 새로운 모듈을 지원하기 위해 타사 모듈을 사용하여 확장 할 수 있습니다.


### Common Gateway Interface
장 일반적으로 "CGI"라고하는이 인터페이스는 가장 오래된 인터페이스로, 거의 모든 웹 서버에서 즉시 지원됩니다. CGI를 사용하여 웹 서버와 통신하는 프로그램은 모든 요청에 ​​대해 서버에 의해 시작되어야합니다. 따라서 모든 요청은 새로운 파이썬 인터프리터를 시작합니다. 시작하는 데 약간의 시간이 걸리므로 전체 인터페이스를 저 부하 상황에서만 사용할 수 있습니다.

CGI의 장점은 간단하다는 것입니다. CGI를 사용하는 파이썬 프로그램을 작성하는 것은 약 3 줄의 코드로 이루어집니다. 이 단순성은 가격으로 제공됩니다. 개발자에게 도움이되는 것은 거의 없습니다.

CGI 프로그램을 작성하는 것은 더 이상 권장되지 않습니다. 이 문서의 뒷부분에서 다루는 WSGI를 사용하면 CGI를 에뮬레이트하는 프로그램을 작성할 수 있으므로 더 좋은 옵션을 사용할 수없는 경우 CGI로 실행할 수 있습니다.

#### Simple script for testing CGI

웹 서버가 CGI와 함께 작동하는지 테스트하려면 간단하고 간단한 CGI 프로그램을 사용할 수 있습니다.

```
#!/usr/bin/env python
# -*- coding: UTF-8 -*-

# enable debugging

import cgitb
cgitb.enable()

print "Content-Type: text/plain;charset=utf-8"
print

print "Hello World!"
```

웹 서버 구성에 따라이 코드를 .py 또는 .cgi 확장자로 저장해야 할 수도 있습니다. 또한 보안상의 이유로이 파일은 cgi-bin 폴더에 있어야 할 수도 있습니다.

cgitb 줄이 무엇인지 궁금 할 것입니다. 이 행을 사용하면 사용자 브라우저에 "내부 서버 오류"가 표시되고 충돌하는 대신 멋진 추적을 표시 할 수 있습니다. 이것은 디버깅에 유용하지만 일부 기밀 데이터가 사용자에게 노출 될 수 있습니다. 이런 이유로 프로덕션 코드에서 cgitb를 사용하면 안됩니다. 예외를 항상 잡아서 적절한 오류 페이지를 표시해야합니다. 최종 사용자는 브라우저에 "내부 서버 오류"라는 말을 싫어합니다.

#### Common problems with CGI scripts

CGI를 사용하면 이러한 스크립트를 실행하는 중 때때로 약간의 성가심이 생깁니다. 때로는 겉으로보기에는 올바른 스크립트가 예상대로 작동하지 않습니다. 원인은 발견하기 어려운 작은 숨겨진 문제입니다.

이러한 잠재적 인 문제 중 일부는 다음과 같습니다.


- Python 스크립트가 실행 가능으로 표시되어 있지 않습니다. CGI 스크립트가 실행 가능하지 않을 때 대부분의 웹 서버는 사용자가 그것을 실행하고 출력을 사용자에게 보내지 않고 다운로드하도록합니다. CGI 스크립트가 유닉스 계열 운영 체제에서 제대로 작동하려면 + x 비트를 설정해야합니다. chmod a + x를 사용하면 your_script.py가이 문제를 해결할 수 있습니다.

- Unix 계열 시스템에서, 프로그램 파일의 줄 끝은 Unix 스타일 줄 끝이어야합니다. 이것은 웹 서버가 스크립트의 첫 번째 줄 (shebang)을 검사하고 거기에 지정된 프로그램을 실행하려고하기 때문에 중요합니다. Windows 줄 끝 (캐리지 리턴 및 줄 바꿈, CRLF라고도 함)에 의해 쉽게 혼동되기 때문에 파일을 Unix 줄 끝 (줄 바꿈, LF 만)으로 변환해야합니다. 이것은 바이너리 모드가 아닌 텍스트 모드로 FTP를 통해 파일을 업로드함으로써 자동으로 수행 될 수 있지만, 선호되는 방법은 유닉스 라인 엔딩으로 파일을 저장하라는 것입니다. 대부분의 편집인이이를 지원합니다.

- 웹 서버가 파일을 읽을 수 있어야하며 권한이 올바른지 확인해야합니다. 유닉스 계열 시스템에서 서버는 사용자 및 그룹 www- 데이터로 실행되는 경우가 많으므로 chmod a + r your_script.py를 사용하여 파일 소유권을 변경하거나 파일을 읽을 수있게 만드는 것이 좋습니다.

- 웹 서버는 액세스하려는 파일이 CGI 스크립트임을 알아야합니다. 웹 서버의 구성을 확인하십시오. CGI 스크립트의 특정 파일 확장명을 예상하도록 구성되어있을 수 있습니다.

- 유닉스 계열 시스템에서, shebang (#! / usr / bin / env python)에있는 인터프리터의 경로가 정확해야합니다. 이 행은 / usr / bin / env를 호출하여 파이썬을 찾지 만 / usr / bin / env가 없거나 파이썬이 웹 서버 경로에 없으면 실패합니다. 파이썬이 설치된 곳을 알고 있다면, 그 전체 경로를 사용할 수도 있습니다. whereis python 및 -p python 명령을 사용하면 설치 위치를 쉽게 찾을 수 있습니다. 경로를 알았 으면 #! / usr / bin / python에 따라 변경 될 수 있습니다.

- 파일에 BOM (Byte Order Mark)이 없어야합니다. BOM은 UTF-16 및 UTF-32 인코딩의 바이트 순서를 결정하기위한 것이지만 일부 편집자는 이것을 UTF-8 파일에도 씁니다. BOM은 shebang 라인을 방해하므로 BOM을 쓰지 않도록 편집자에게 알려야합니다.

- 웹 서버가 mod_python을 사용하고 있다면 mod_python에 문제가있을 수 있습니다. mod_python은 CGI 스크립트 자체를 처리 할 수 ​​있지만 문제의 원인이 될 수도 있습니다.

### mod_python
PHP에서 오는 사람들은 종종 웹에서 파이썬을 사용하는 방법을 이해하기가 어렵습니다. 그들의 첫 번째 생각은 대부분 mod_python이다. 왜냐하면 이것이 mod_php와 같다고 생각하기 때문이다. 사실, 많은 차이가 있습니다. mod_python이 하는 일은 인터프리터를 아파치 프로세스에 삽입하기 때문에 각 요청에 대해 파이썬 인터프리터를 시작할 필요가 없기 때문에 요청 속도가 빨라진다. 반면에 PHP가 종종 HTML과 섞이는 방식으로 "파이썬이 HTML과 섞여있는"것은 아닙니다. 파이썬에 해당하는 것은 템플릿 엔진입니다. mod_python 자체는 훨씬 강력하고 Apache 내부에 더 많은 액세스를 제공합니다. CGI를 에뮬레이션 할 수 있으며 "Python Server Pages"모드 (JSP와 유사)에서 "Python과 혼합 된 HTML"이며 모든 파일을 하나의 파일로 지정하여 파일로 처리 할 방법을 결정합니다 .

mod_python에는 몇 가지 문제가 있습니다. PHP 인터프리터와 달리 파이썬 인터프리터는 파일을 실행할 때 캐싱을 사용하므로 파일을 변경하려면 웹 서버를 다시 시작해야합니다. 또 다른 문제는 기본 개념입니다. 아파치는 요청을 처리하기 위해 자식 프로세스를 시작합니다. 불행히도 모든 자식 프로세스는 그것을 사용하지 않더라도 전체 파이썬 인터프리터를로드해야합니다. 이로 인해 전체 웹 서버가 느려집니다. 또 다른 문제는 mod_python이 특정 버전의 libpython과 연결되어 있기 때문에 mod_python을 다시 컴파일하지 않고 이전 버전에서 최신 버전 (예 : 2.4에서 2.5)으로 전환 할 수 없다는 것입니다. mod_python은 또한 Apache 웹 서버에 바인딩되어 있으므로 mod_python 용으로 작성된 프로그램은 다른 웹 서버에서 쉽게 실행할 수 없습니다.

새로운 프로그램을 작성할 때 mod_python을 피해야하는 이유는 다음과 같습니다. 경우에 따라 배포를 위해 mod_python을 사용하는 것이 좋습니다.하지만 WSGI를 사용하면 mod_python에서도 WSGI 프로그램을 실행할 수 있습니다.

### FastCGI and SCGI

FastCGI와 SCGI는 다른 방식으로 CGI의 성능 문제를 해결하려고합니다. 인터프리터를 웹 서버에 임베드하는 대신 장시간 실행되는 백그라운드 프로세스를 작성합니다. 웹 서버가 백그라운드 프로세스와 "말하게"할 수있게 해주는 모듈이 여전히 웹 서버에 있습니다. 백그라운드 프로세스는 서버와 독립적이므로 Python을 비롯한 모든 언어로 작성할 수 있습니다. 언어는 웹 서버와의 통신을 처리하는 라이브러리가 필요합니다.

FastCGI와 SCGI의 차이는 매우 작습니다. SCGI는 본질적으로 단순한 FastCGI이기 때문입니다. SCGI에 대한 웹 서버 지원이 제한되어 있으므로 대부분의 사람들은 FastCGI를 대신 사용하며 이는 동일한 방식으로 작동합니다. SCGI에 적용되는 거의 모든 것이 FastCGI에도 적용되므로, 우리는 후자에 대해서만 다룰 것입니다.

요즘 FastCGI는 절대로 직접 사용되지 않습니다. mod_python과 마찬가지로 WSGI 응용 프로그램 배포에만 사용됩니다.

### mod_wsgi

## Step back: WSGI
WSGI는 이미 여러 번 언급되었으므로 중요해야합니다. 실제로 그것은 실제로, 지금은 설명 할 시간입니다.

Web Server Gateway Interface (WSGI)는 PEP 333에 정의되어 있으며 현재 Python 웹 프로그래밍을 수행하는 가장 좋은 방법입니다. 프로그래머가 프레임 워크를 작성하는 것은 좋지만, 일반 웹 개발자는 직접 프레임 워크에 접속할 필요가 없습니다. 웹 개발을위한 프레임 워크를 선택할 때 WSGI를 지원하는 프레임 워크를 선택하는 것이 좋습니다.

WSGI의 큰 이점은 응용 프로그램 프로그래밍 인터페이스의 통합입니다. 프로그램이 WSGI와 호환 될 때 (외부 레벨에서 사용하는 프레임 워크가 WSGI를 지원한다는 의미) - 프로그램은 WSGI 랩퍼가있는 웹 서버 인터페이스를 통해 전개 될 수 있습니다. 응용 프로그램 사용자가 mod_python 또는 FastCGI 또는 mod_wsgi를 사용하는지 여부는 신경 쓰지 않아도됩니다. WSGI를 사용하면 응용 프로그램이 모든 게이트웨이 인터페이스에서 작동합니다. Python 표준 라이브러리에는 자체 WSGI 서버 인 wsgiref가 포함되어 있습니다. wsgiref는 테스트에 사용할 수있는 작은 웹 서버입니다.

정말 훌륭한 WSGI 기능은 미들웨어입니다. 미들웨어는 다양한 기능을 추가 할 수있는 프로그램 주위의 계층입니다. 이미 사용 가능한 미들웨어가 상당히 있습니다. 예를 들어, 자신의 세션 관리 (HTTP는 상태 비 저장 프로토콜이므로 여러 HTTP 요청을 단일 사용자와 연결하여 응용 프로그램이 세션을 통해 그러한 상태를 만들고 관리해야 함) 대신에 플러그인 인 미들웨어를 다운로드하면됩니다 응용 프로그램의 고유 한 부분을 코딩하여 작업하십시오. 압축 할 때도 마찬가지입니다. 서버의 대역폭을 절약하기 위해 gzip을 사용하여 HTML을 압축하는 기존 미들웨어가 있습니다. 인증은 기존 미들웨어를 사용하여 쉽게 해결할 수있는 또 다른 문제입니다.

WSGI와 관련 미들웨어는 웹 사이트를 개발하는 동안 발생할 수있는 많은 문제에 대한 솔루션을 이미 가지고 있기 때문에 WSGI는 복잡해 보일 수 있지만 학습 초기 단계는 매우 보람을 느낄 수 있습니다.

### WSGI Servers 
CGI 또는 mod_python과 같은 다양한 저수준 게이트웨이에 연결하는 데 사용되는 코드를 WSGI 서버라고합니다. 이 서버 중 하나는 flup이며 FastCGI 및 SCGI는 물론 AJP를 지원합니다. 이 서버 중 일부는 Python으로 flup이 작성되었지만 C로 작성되고 드롭 인 대체로 사용할 수있는 다른 서버도 있습니다.

이미 많은 서버가 있으므로, 거의 모든 곳에서 Python 웹 응용 프로그램을 배포 할 수 있습니다. 이것은 파이썬이 다른 웹 기술과 비교 한 큰 장점 중 하나입니다.

WSGI 관련 코드의 개요는 WSGI를 지원하는 모든 응용 프로그램에서 사용할 수있는 WSGI 서버의 광범위한 목록을 포함하고있는 WSGI 홈페이지에서 찾을 수 있습니다.
이미 표준 라이브러리에 포함되어있는 WSGI 지원 모듈에 관심이있을 수 있습니다.

wsgiref - WSGI를위한 몇 가지 작은 유틸리티 및 서버

### Case study : MoinMoin
WSGI는 웹 애플리케이션 개발자에게 무엇을 제공합니까? 잠시 동안 WSGI를 사용하지 않고 파이썬으로 작성된 애플리케이션을 살펴 보겠습니다.

가장 널리 사용되는 위키 소프트웨어 패키지 중 하나는 MoinMoin입니다. 2000 년에 만들어 졌으므로 WSGI보다 약 3 년 앞선 것입니다. 이전 버전에서는 CGI, mod_python, FastCGI 및 독립 실행 형에서 별도의 코드를 실행해야했습니다.

이제 WSGI에 대한 지원이 포함됩니다. WSGI를 사용하면 추가 접착제 코드없이 모든 WSGI 준수 서버에 MoinMoin을 배포 할 수 있습니다. WSGI 이전 버전과 달리 여기에는 MoinMoin의 저자가 전혀 알지 못하는 WSGI 서버가 포함될 수 있습니다.

## Model-View-Controller

MVC라는 용어는 "framework foo가 MVC를 지원합니다."와 같은 문장에서 자주 발생합니다. MVC는 특정 API가 아닌 전체 코드 구성에 관한 것입니다. 많은 웹 프레임 워크는 개발자가 프로그램에 구조를 가져올 수 있도록이 모델을 사용합니다. 더 큰 웹 응용 프로그램은 많은 코드를 가질 수 있으므로 처음부터 효과적인 구조를 만드는 것이 좋습니다. 그렇게하면 다른 프레임 워크 사용자 (또는 MVC가 파이썬에만 국한된 것이 아니기 때문에 다른 언어도)는 이미 MVC 구조에 익숙하므로 코드를 쉽게 이해할 수 있습니다.

MVC는 세 가지 구성 요소를 나타냅니다.

모델. 이것은 표시되고 수정 될 데이터입니다. 파이썬 프레임 워크에서이 컴포넌트는 종종 객체 - 관계 매퍼 (object-relational mapper)가 사용하는 클래스로 표현됩니다.
보기. 이 구성 요소의 역할은 모델의 데이터를 사용자에게 표시하는 것입니다. 일반적으로이 구성 요소는 템플릿을 통해 구현됩니다.
컨트롤러. 이것은 사용자와 모델 사이의 계층입니다. 컨트롤러는 사용자 동작 (특정 URL 열기와 같은)에 반응하고 필요한 경우 모델에 데이터 수정을 알리고 표시 코드에 무엇을 표시할지 알려주고,
MVC는 복잡한 디자인 패턴이라고 생각할 수도 있지만 실제로는 그렇지 않습니다. 깨끗하고 유지 보수가 쉬운 웹 사이트를 만드는 데 유용하기 때문에 파이썬에서 사용됩니다.

참고 : 모든 파이썬 프레임 워크가 MVC를 명시 적으로 지원하는 것은 아니지만, 사용자 상호 작용 로직 (컨트롤러)과 템플릿 (뷰)에서 데이터 로직 (모델)을 분리하여 MVC 패턴을 사용하는 웹 사이트를 만드는 것은 흔하지 않습니다. . 그렇기 때문에 템플릿에 불필요한 Python 코드를 작성하지 않는 것이 중요합니다. MVC 모델에 대해 작동하고 코드 기반에 혼란을 야기하므로 이해 및 수정이 더 어려워집니다.


https://docs.python.org/2.7/howto/webservers.html#some-notable-frameworks
